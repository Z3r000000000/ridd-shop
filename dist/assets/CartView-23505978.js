import{_ as v,f as g,o as c,c as o,b as t,e as _,t as n,i as d,F as f,r as k,g as m,w as I,h as y,p as b,d as w}from"./index-e1daf5a8.js";const C="/ridd-shop/assets/cart-delete-icon-997d757f.svg";const P={data(){return{cartItems:[],removedItem:null,totalPrice:0,isLogin:!1}},async mounted(){await this.loadCartItems(),this.calculateTotalPrice()},methods:{async loadCartItems(){try{this.isLogin=JSON.parse(localStorage.getItem("isLoggedIn"));const e=JSON.parse(localStorage.getItem("user")),a=await(await fetch(`https://ec4cde03eba81a3e.mokky.dev/cart?usersId=${e.id}`)).json();this.cartItems=await Promise.all(a.map(async h=>{const p=await(await fetch(`https://ec4cde03eba81a3e.mokky.dev/items/${h.itemsId}`)).json();return{id:h.id,product:p}}))}catch(e){console.error("Ошибка при загрузке корзины:",e)}},async removeFromCart(e){try{const r=JSON.parse(localStorage.getItem("user"));await fetch(`https://ec4cde03eba81a3e.mokky.dev/cart/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({usersId:r.id})}),this.removedItem=this.cartItems.find(a=>a.id===e),this.cartItems=this.cartItems.filter(a=>a.id!==e),this.calculateTotalPrice()}catch(r){console.error("Ошибка при удалении товара из корзины:",r)}},calculateTotalPrice(){this.totalPrice=this.cartItems.reduce((e,r)=>e+r.product.price,0)}}},l=e=>(b("data-v-8bab6e53"),e=e(),w(),e),S={class:"pageContent"},L={class:"section section_noPadT"},N={class:"wrapper"},T=l(()=>t("div",{class:"crumbs"},[t("span",null,[t("span",null,[t("a",{href:"/"},"Главная")]),_(" / "),t("span",null,"Корзина")])],-1)),B={class:"h3 section__title"},x={key:0,class:"cartTitleAmount"},V={key:0,class:"cart"},E={class:"cart__left"},F={key:0,class:"cart__notices"},H={class:"notice notice_done"},J=l(()=>t("div",{class:"cartHead"},[t("p",{class:"cartHead__item"},"Цена"),t("p",{class:"cartHead__item"}),t("p",{class:"cartHead__item"})],-1)),O={href:"#",class:"cartItemProduct"},j={class:"cartItemProduct__image"},D=l(()=>t("span",{class:"cartItemProduct__padding"},null,-1)),R=["src","alt"],W={class:"cartItemProduct__title"},A={class:"cartItem__price"},M=["onClick"],q=l(()=>t("img",{src:C,alt:""},null,-1)),z=[q],G={class:"cart__right"},K={class:"cart__total"},Q={key:1,class:"errorSection"},U={class:"wrapper"},X={class:"errorBlock"},Y=l(()=>t("h1",{class:"h1 errorBlock__title"},"Нужно добавить товары для заказа",-1)),Z={class:"buttonWrap center"},$={key:2,class:"errorSection"},tt={class:"wrapper"},et={class:"errorBlock"},st=l(()=>t("h1",{class:"h1 errorBlock__title"},"Нужно авторизироваться, чтобы можно было заказать",-1)),ct={class:"buttonWrap center"};function ot(e,r,a,h,s,p){const u=g("router-link");return c(),o("main",S,[t("section",L,[t("div",N,[T,t("h1",B,[_(" Корзина "),s.cartItems.length>0?(c(),o("span",x,n(s.cartItems.length)+" товара, "+n(s.totalPrice)+" ₽ ",1)):d("",!0)]),s.cartItems.length>0&s.isLogin?(c(),o("div",V,[t("div",E,[s.removedItem?(c(),o("div",F,[t("div",H,n(s.removedItem.product.title)+" удалён",1)])):d("",!0),J,(c(!0),o(f,null,k(s.cartItems,i=>(c(),o("div",{class:"cartItem",key:i.id},[t("a",O,[t("span",j,[D,t("img",{src:i.product.image,alt:i.product.title},null,8,R)]),t("span",W,n(i.product.title),1)]),t("p",A,n(i.product.price)+" ₽",1),t("a",{href:"#",class:"cartItem__delete",title:"Удалить из корзины",onClick:y(rt=>p.removeFromCart(i.id),["prevent"])},z,8,M)]))),128))]),t("div",G,[t("p",K,[_("Итого: "),t("strong",null,n(s.totalPrice)+" ₽",1)]),m(u,{to:"/checkout",class:"btn"},{default:I(()=>[_("Оформить заказ")]),_:1})])])):d("",!0),s.cartItems.length<0&s.isLogin?(c(),o("section",Q,[t("div",U,[t("div",X,[Y,t("div",Z,[m(u,{to:"/shop",class:"btn btn_l"},{default:I(()=>[_("В магазин")]),_:1})])])])])):d("",!0),s.isLogin?d("",!0):(c(),o("section",$,[t("div",tt,[t("div",et,[st,t("div",ct,[m(u,{to:"/auth",class:"btn btn_l"},{default:I(()=>[_("Авторизироваться")]),_:1})])])])]))])])])}const it=v(P,[["render",ot],["__scopeId","data-v-8bab6e53"]]);export{it as default};
