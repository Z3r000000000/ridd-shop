import{_ as p,f as v,o as d,c as i,b as s,F as f,r as I,e as l,g,w as y,a as C,h as k,n as S,t as h,p as T,d as w}from"./index-e1daf5a8.js";const b={data(){return{data:[],favoriteProducts:[],cartItems:[],loading:!1,error:null,addedToCart:{},showAddedToCartText:{},userId:[],buttonText:{},userIs:!1}},async mounted(){const t=JSON.parse(localStorage.getItem("user"));this.userIs=!!t,this.userId=t==null?void 0:t.id,await this.fetchData(),await this.loadFavoriteProducts(),await this.loadCartItems(),this.updateAddedToCartState()},methods:{async fetchData(){localStorage.getItem("user")==!0&&(userIs=!0);try{this.loading=!0;const t=await fetch(`https://ec4cde03eba81a3e.mokky.dev/items?categoryId=${this.$route.params.categoryId}`),e=await t.json();if(!t.ok)throw new Error(e.message||"Something went wrong");this.data=e}catch(t){this.error=t.message}finally{this.loading=!1,console.log(this.$route.params.categoryId)}},loadFavoriteProducts(){const t=JSON.parse(localStorage.getItem("user")).id;fetch(`https://ec4cde03eba81a3e.mokky.dev/favorite?userId=${t}`).then(e=>e.json()).then(e=>{this.favoriteProducts=e})},loadCartItems(){const t=JSON.parse(localStorage.getItem("user")).id;fetch(`https://ec4cde03eba81a3e.mokky.dev/cart?usersId=${t}`).then(e=>e.json()).then(e=>{this.cartItems=e})},toggleFavorite(t){const e=JSON.parse(localStorage.getItem("user")).id,o=this.favoriteProducts.find(r=>r.productId===t&&r.userId===e);o?fetch(`https://ec4cde03eba81a3e.mokky.dev/favorite/${o.id}`,{method:"DELETE"}).then(()=>{this.loadFavoriteProducts()}):fetch("https://ec4cde03eba81a3e.mokky.dev/favorite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,productId:t})}).then(r=>r.json()).then(()=>{this.loadFavoriteProducts()})},async loadCartItems(){const t=JSON.parse(localStorage.getItem("user")).id,e=await fetch(`https://ec4cde03eba81a3e.mokky.dev/cart?usersId=${t}`);this.cartItems=await e.json()},updateAddedToCartState(){this.addedToCart={},this.buttonText={},this.showAddedToCartText={};for(const t of this.cartItems)this.addedToCart[t.itemsId]=!0,this.buttonText[t.itemsId]="Добавлена",this.showAddedToCartText[t.itemsId]=!1},async addToCart(t){const e=JSON.parse(localStorage.getItem("user")).id;if(!this.addedToCart[t])try{await fetch("https://ec4cde03eba81a3e.mokky.dev/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemsId:t,usersId:e})}),await this.loadCartItems(),this.updateAddedToCartState()}catch(o){console.error("Ошибка при добавлении товара в корзину:",o)}},isFavorite(t){const e=JSON.parse(localStorage.getItem("user")).id;return this.favoriteProducts.some(o=>o.productId===t&&o.userId===e)}}},_=t=>(T("data-v-e65262fe"),t=t(),w(),t),x={class:"pageContent"},N={class:"section section_noPadT"},P={class:"wrapper"},F=C('<div class="crumbs" data-v-e65262fe><span data-v-e65262fe><span data-v-e65262fe><a href="/" data-v-e65262fe>Главная</a></span> / <span data-v-e65262fe><a href="" data-v-e65262fe>Магазин</a></span> / <span data-v-e65262fe>Смартфоны</span></span></div><h1 class="h3 section__title" data-v-e65262fe>Смартфоны</h1><div class="catalogHead" data-v-e65262fe></div>',3),O={class:"catalog__content"},J=_(()=>s("div",{class:"message"},[s("p")],-1)),j={key:0,class:"productsList"},A=["onClick"],V=["src"],D={class:"productsItemImage"},E=_(()=>s("span",{class:"productsItemImage__padding"},null,-1)),$=["src","alt"],B={class:"productsItem__title"},L={class:"productsItem__price"},z={class:"productsItem__cart"},H=["onClick","disabled"],M={key:0,class:"added-to-cart-text"},q={key:1},G={key:1,class:"cart__notices"},K={class:"notice notice_done"};function Q(t,e,o,r,c,n){const u=v("router-link");return d(),i("main",x,[s("section",N,[s("div",P,[F,s("div",O,[J,c.userIs?(d(),i("div",j,[(d(!0),i(f,null,I(c.data,a=>(d(),i("div",{key:a.id,class:"productsItem"},[s("div",{class:"productsItem__wishlist",title:"Добавить в избранное",onClick:k(m=>n.toggleFavorite(a.id),["prevent"])},[s("img",{src:n.isFavorite(a.id)?"../img/product-wishlist-active.svg":"../img/product-wishlist.svg",alt:"",class:S({active:n.isFavorite(a.id)})},null,10,V)],8,A),s("div",D,[E,s("img",{src:a.image,alt:a.title},null,8,$)]),s("div",B,h(a.title),1),s("p",L,h(a.price)+" ₽",1),s("div",z,[s("button",{class:"btn btn_s btn_full",onClick:m=>n.addToCart(a.id),disabled:c.addedToCart[a.id]},[c.addedToCart[a.id]?(d(),i("span",M,"Добавлено!")):(d(),i("span",q,"В корзину"))],8,H)])]))),128))])):(d(),i("div",G,[s("div",K,[l("Для добавления товаров в избранное или корзину, необходимо "),g(u,{to:"/auth"},{default:y(()=>[l("авторизоваться")]),_:1}),l(".")])]))])])])])}const U=p(b,[["render",Q],["__scopeId","data-v-e65262fe"]]);export{U as default};
