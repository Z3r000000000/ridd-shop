import{_ as m,o as p,c as u,b as e,h as f,l as d,v as n,x as v,F as y,r as k,e as _,t as h,p as b,d as g}from"./index-e1daf5a8.js";const A={data(){return{cartItems:[],orderAddress:{postcode:"",region:"default",address:"",flat:"",podezd:"",floor:"",comment:""},totalPrice:0}},async mounted(){await this.loadCartItems(),this.calculateTotalPrice()},methods:{async loadCartItems(){try{const r=JSON.parse(localStorage.getItem("user")),i=await(await fetch(`https://ec4cde03eba81a3e.mokky.dev/cart?usersId=${r.id}`)).json();this.cartItems=await Promise.all(i.map(async l=>{const a=await(await fetch(`https://ec4cde03eba81a3e.mokky.dev/items/${l.itemsId}`)).json();return{id:l.id,product:a}}))}catch(r){console.error("Ошибка при загрузке корзины:",r)}},calculateTotalPrice(){this.totalPrice=this.cartItems.reduce((r,t)=>r+t.product.price,0)},async submitOrder(){try{const r=JSON.parse(localStorage.getItem("user")),t=new Date().toISOString(),i={userId:r.id,status:"Заказ зарегистрирован",createdAt:t},o=await(await fetch("https://ec4cde03eba81a3e.mokky.dev/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();for(const s of this.cartItems)await fetch("https://ec4cde03eba81a3e.mokky.dev/orderitems",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.id,itemId:s.product.id,orderId:o.id})}),await this.removeFromCart(s.id);const a={id:o.id,postcode:this.orderAddress.postcode,region:this.orderAddress.region,address:this.orderAddress.address,flat:this.orderAddress.flat,podezd:this.orderAddress.podezd,floor:this.orderAddress.floor,comment:this.orderAddress.comment};await fetch("https://ec4cde03eba81a3e.mokky.dev/ordersadress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),this.$router.push("/order-success")}catch(r){console.error("Ошибка при оформлении заказа:",r)}},async removeFromCart(r){try{const t=JSON.parse(localStorage.getItem("user"));await fetch(`https://ec4cde03eba81a3e.mokky.dev/cart/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({usersId:t.id})}),this.cartItems=this.cartItems.filter(i=>i.id!==r),this.calculateTotalPrice()}catch(t){console.error("Ошибка при удалении товара из корзины:",t)}}}},c=r=>(b("data-v-17f3ff1e"),r=r(),g(),r),I={class:"pageContent"},S={class:"section section_noPadT"},w={class:"wrapper"},P=c(()=>e("div",{class:"crumbs"},[e("span",null,[e("span",null,[e("a",{href:"/"},"Главная")]),_(" / "),e("span",null,"Оформление заказа")])],-1)),T=c(()=>e("h1",{class:"h3 section__title checkoutPageTitle"},"Оформление заказа",-1)),O={class:"checkout__left"},x={class:"checkoutBlock"},C={class:"inputs"},V={class:"input input_half"},N={class:"input input_half"},D={class:"select"},j=c(()=>e("option",{value:"default",disabled:"",selected:""},"Страна/регион*",-1)),J=c(()=>e("option",{value:"rus"},"Россия",-1)),U=c(()=>e("option",{value:"bel"},"Беларусь",-1)),q=c(()=>e("option",{value:"kax"},"Казахстан",-1)),z=[j,J,U,q],B={class:"input"},E={class:"input input_third"},F={class:"input input_third"},R={class:"input input_third"},M={class:"input"},L={class:"checkout__right"},G={class:"checkout__products"},H={class:"checkoutProduct__title"},K={class:"checkoutProduct__info"},Q={class:"checkout__info"},W={class:"checkout__total"},X=c(()=>e("button",{type:"submit",class:"btn btn_full"},"Подтвердить заказ",-1));function Y(r,t,i,l,o,a){return p(),u("main",I,[e("section",S,[e("div",w,[P,T,e("form",{onSubmit:t[7]||(t[7]=f((...s)=>a.submitOrder&&a.submitOrder(...s),["prevent"])),class:"checkout"},[e("div",O,[e("div",x,[e("div",C,[e("div",V,[d(e("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=s=>o.orderAddress.postcode=s),name:"postcode",placeholder:"Почтовый индекс*",autocomplete:"off",required:""},null,512),[[n,o.orderAddress.postcode]])]),e("div",N,[e("div",D,[d(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.orderAddress.region=s),name:"region",required:""},z,512),[[v,o.orderAddress.region]])])]),e("div",B,[d(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>o.orderAddress.address=s),name:"address",placeholder:"Область, город, улица, дом*",autocomplete:"off",required:""},null,512),[[n,o.orderAddress.address]])]),e("div",E,[d(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>o.orderAddress.flat=s),name:"flat",placeholder:"Квартира/офис",autocomplete:"off",required:""},null,512),[[n,o.orderAddress.flat]])]),e("div",F,[d(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>o.orderAddress.podezd=s),name:"podezd",placeholder:"Подъезд",autocomplete:"off",required:""},null,512),[[n,o.orderAddress.podezd]])]),e("div",R,[d(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>o.orderAddress.floor=s),name:"floor",placeholder:"Этаж",autocomplete:"off",required:""},null,512),[[n,o.orderAddress.floor]])]),e("div",M,[d(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.orderAddress.comment=s),name:"comment",rows:"4",placeholder:"Комментарий к заказу"},null,512),[[n,o.orderAddress.comment]])])])])]),e("div",L,[e("div",G,[(p(!0),u(y,null,k(o.cartItems,s=>(p(),u("div",{class:"checkoutProduct",key:s.id},[e("p",H,h(s.product.title),1),e("p",K,h(s.product.price)+" ₽",1)]))),128))]),e("div",Q,[e("p",W,[_("Итого: "),e("strong",null,h(o.totalPrice)+" ₽",1)])]),X])],32)])])])}const $=m(A,[["render",Y],["__scopeId","data-v-17f3ff1e"]]);export{$ as default};
