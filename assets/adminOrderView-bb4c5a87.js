import{_ as A,o as h,c as u,b as t,l as p,x as f,F as v,r as I,t as c,e as O,i as k,p as b,d as V,a as w}from"./index-e1daf5a8.js";const U={name:"OrdersPage",data(){return{orders:[],users:[],orderItems:[],items:[],selectedStatus:"",orderAddress:null,error:"",success:"",isOrderAddressVisible:!1}},mounted(){this.fetchData()},computed:{filteredOrders(){return this.selectedStatus?this.orders.filter(e=>e.status===this.selectedStatus):this.orders}},methods:{async fetchData(){try{const[e,s,r,n]=await Promise.all([fetch("https://ec4cde03eba81a3e.mokky.dev/users"),fetch("https://ec4cde03eba81a3e.mokky.dev/orderitems"),fetch("https://ec4cde03eba81a3e.mokky.dev/orders"),fetch("https://ec4cde03eba81a3e.mokky.dev/items")]);this.users=await e.json(),this.orderItems=await s.json(),this.orders=await r.json(),this.items=await n.json(),this.logOrderDetails()}catch(e){console.error("Ошибка при получении данных:",e),this.error="Произошла ошибка. Попробуйте снова позже."}},toggleOrderAddressVisibility(){this.isOrderAddressVisible=!this.isOrderAddressVisible},async logOrderDetails(){var e,s,r,n,d,l,i;for(const o of this.orders)if(this.users.find(_=>_.id.toString()===o.userId.toString())){const y=this.orderItems.filter(a=>a.orderId.toString()===o.id.toString()).map(a=>{const g=this.items.find(S=>S.id.toString()===a.itemId.toString());return g?{...g,quantity:parseInt(a.quantity)}:null}).filter(a=>a!==null);console.log(`Заказ #${o.id} - ${this.getUserFullName(o.userId)}:`),console.log(`Телефон: ${this.getUserPhone(o.userId)} | Email: ${this.getUserEmail(o.userId)}`),console.log("Товары:"),y.forEach(a=>{console.log(`- ${a.title} (${a.price} руб.)`)}),console.log(`Статус: ${o.status}`),console.log(`Общая цена: ${this.formatPrice(this.calculateOrderTotal(o.id))} руб.`);try{await this.fetchOrderAddress(o.id),console.log("Адрес заказа:"),console.log(`Почтовый индекс: ${((e=this.orderAddress)==null?void 0:e.postcode)||""}`),console.log(`Регион: ${((s=this.orderAddress)==null?void 0:s.region)||""}`),console.log(`Адрес: ${((r=this.orderAddress)==null?void 0:r.address)||""}`),console.log(`Квартира: ${((n=this.orderAddress)==null?void 0:n.flat)||""}`),console.log(`Подъезд: ${((d=this.orderAddress)==null?void 0:d.podezd)||""}`),console.log(`Этаж: ${((l=this.orderAddress)==null?void 0:l.floor)||""}`),console.log(`Комментарий: ${((i=this.orderAddress)==null?void 0:i.comment)||""}`)}catch(a){console.error(`Ошибка при получении адреса заказа #${o.id}:`,a)}console.log("---")}else console.log(`Заказ #${o.id} - Пользователь не найден`)},async fetchOrderAddress(e){const s=await fetch(`https://ec4cde03eba81a3e.mokky.dev/ordersadress?orderId=${e}`);if(s.ok)this.orderAddress=await s.json(),console.log("Ответ с сервера:",this.orderAddress[0]);else throw new Error("Ошибка при получении адреса заказа.")},async updateOrderStatus(e){try{const s=await fetch(`https://ec4cde03eba81a3e.mokky.dev/orders/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e.status})});s.ok?console.log(`Статус заказа #${e.id} обновлен: ${e.status}`):console.error(`Ошибка при обновлении статуса заказа #${e.id}: ${s.status} - ${s.statusText}`)}catch(s){console.error(`Ошибка при обновлении статуса заказа #${e.id}: ${s}`)}},getOrderItems(e){return this.orderItems.filter(r=>r.orderId.toString()===e.toString()).map(r=>{const n=this.items.find(d=>d.id.toString()===r.itemId.toString());return n?{...n,quantity:parseInt(r.quantity)}:null}).filter(r=>r!==null)},getItemQuantity(e,s){const r=this.orderItems.find(n=>n.orderId.toString()===e.toString()&&n.itemId.toString()===s.toString());return r?r.quantity:0},calculateOrderTotal(e){return this.getOrderItems(e).reduce((r,n)=>r+(n.price||0)*this.getItemQuantity(e,n.id),0)},formatPrice(e){return e.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$& ")},getUserFullName(e){const s=this.users.find(r=>r.id.toString()===e.toString());return s?`${s.firstName} ${s.lastName}`:"Неизвестный пользователь"},getUserPhone(e){const s=this.users.find(r=>r.id.toString()===e.toString());return s?s.phone:"Неизвестный номер"},getUserEmail(e){const s=this.users.find(r=>r.id.toString()===e.toString());return s?s.email:"Неизвестный email"}}},m=e=>(b("data-v-8253810c"),e=e(),V(),e),$={class:"bl"},N={class:"shop-toggle"},F={class:"filters"},x={class:"filter-status"},P=w('<option value="" data-v-8253810c>Все</option><option value="Заказ зарегистрирован" data-v-8253810c>Заказ зарегистрирован</option><option value="Подготавливается" data-v-8253810c>Подготавливается</option><option value="Отправлено" data-v-8253810c>Отправлено</option><option value="Выполнено" data-v-8253810c>Выполнено</option>',5),E=[P],j={key:0,class:"container"},C=m(()=>t("h1",null,"Заказы пользователей",-1)),D={class:"order-header"},T={class:"order-id"},q={class:"order-user"},B={class:"user-details"},R={class:"order-status"},z=["onUpdate:modelValue"],Q=m(()=>t("option",{value:"Заказ зарегистрирован"},"Заказ зарегистрирован",-1)),H=m(()=>t("option",{value:"Подготавливается"},"Подготавливается",-1)),J=m(()=>t("option",{value:"Отправлено"},"Отправлено",-1)),L=m(()=>t("option",{value:"Выполнено"},"Выполнено",-1)),M=[Q,H,J,L],G=["onClick"],K={class:"order-items"},W={class:"item-name"},X={class:"item-price"},Y={key:0,class:"order-address order-items"},Z=m(()=>t("h3",{class:"order-address-items item-name"},"Адрес заказа",-1)),ee={class:"order-address-items item-price"},se={class:"order-address-items item-price"},te={class:"order-address-items item-price"},re={class:"order-address-items item-price"},oe={class:"order-address-items item-price"},de={class:"order-address-items item-price"},ie={class:"order-address-items item-price"},ne={key:1,class:"container"},ce=m(()=>t("h1",{class:"h1 errorBlock__title center"},"Таких заказов нет.",-1)),le=[ce];function ae(e,s,r,n,d,l){return h(),u("div",$,[t("nav",null,[t("div",N,[t("div",F,[t("div",x,[p(t("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>d.selectedStatus=i)},E,512),[[f,d.selectedStatus]])])])])]),l.filteredOrders.length>0?(h(),u("div",j,[C,(h(!0),u(v,null,I(l.filteredOrders,i=>(h(),u("div",{class:"orders",key:i.id},[t("div",D,[t("div",T,"Заказ #"+c(i.id),1),t("div",q,[O(c(l.getUserFullName(i.userId))+" ",1),t("div",B,c(l.getUserPhone(i.userId))+" | "+c(l.getUserEmail(i.userId)),1)]),t("div",R,[p(t("select",{"onUpdate:modelValue":o=>i.status=o},M,8,z),[[f,i.status]]),t("button",{onClick:o=>l.updateOrderStatus(i)},"Обновить статус",8,G)])]),t("div",K,[(h(!0),u(v,null,I(l.getOrderItems(i.id),o=>(h(),u("div",{class:"order-item",key:o.id},[t("div",W,c(o.title),1),t("div",X,c(o.price)+" руб.",1)]))),128)),t("button",{class:"order-address-toggle",onClick:s[1]||(s[1]=(...o)=>l.toggleOrderAddressVisibility&&l.toggleOrderAddressVisibility(...o))},c(d.isOrderAddressVisible?"Скрыть":"Показать")+" адрес заказа ",1)]),d.isOrderAddressVisible&&d.orderAddress&&d.orderAddress.length>0&&d.orderAddress[0].orderId===i.id?(h(),u("div",Y,[Z,t("p",ee,"Почтовый индекс: "+c(d.orderAddress[0].postcode),1),t("p",se,"Регион: "+c(d.orderAddress[0].region),1),t("p",te,"Адрес: "+c(d.orderAddress[0].address),1),t("p",re,"Квартира: "+c(d.orderAddress[0].flat),1),t("p",oe,"Подъезд: "+c(d.orderAddress[0].podezd),1),t("p",de,"Этаж: "+c(d.orderAddress[0].floor),1),t("p",ie,"Комментарий: "+c(d.orderAddress[0].comment),1)])):k("",!0)]))),128))])):(h(),u("div",ne,le))])}const me=A(U,[["render",ae],["__scopeId","data-v-8253810c"]]);export{me as default};
